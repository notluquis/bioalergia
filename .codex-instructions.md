# Codex / AI Instructions for finanzas-app

## Tech Stack

- **Frontend**: React 19, Vite, TypeScript, Tailwind CSS, DaisyUI
- **Backend**: Node.js, Express, Prisma, PostgreSQL
- **Key libs**: TanStack Query, Zustand, React Hook Form, Zod

## 2025 Gold Standards (Critical)

### 1. Authorization (RBAC)

- **Rule**: Do NOT use hardcoded role strings like "GOD" or "ADMIN".
- **Fix**: Use permission checks.
  - Backend: `req.ability.can('manage', 'all')`
  - Frontend: `can('manage', 'all')`

### 2. Styling (Harmonic Layout)

- **Rule**: Use Semantic DaisyUI tokens. NO `bg-white`, NO `text-gray-500`.
- **Fix**: `bg-base-100`, `text-base-content/70`.
- **Layout**: Use `pt-[env(safe-area-inset-top)]` for layout roots.
- **Badges**: Use `bg-success/15 text-success` for Light/Dark mode compatibility.

### 3. Architecture

- **Feature Folders**: Code lives in `src/features/{domain}/` (colocated `api.ts`, `hooks/`, `types.ts`).
- **Data Fetching**: Use `useQuery` hooks, do not `fetch` inside components.

## Common Tasks

### Creating a New Page

1. Create in `src/features/{domain}/pages/`.
2. Wrap with `<LazyLoad>` or lazy import in `routes`.
3. Use `PageContainer` or standard layout wrapper (Harmonic).

### Database Access

- Use `prisma` client.
- Raw SQL must be **PostgreSQL** (`TO_CHAR`, `EXTRACT`).
- Respect `@@map` table names.

## Safety

- Validate all inputs with Zod.
- Validate `Int32` limits for amounts.
- Run `npm run type-check` before any commit.
