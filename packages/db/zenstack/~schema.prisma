//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
    provider = "postgresql"
    url = env("DATABASE_URL")
    schemas = ["public", "personal"]
}

generator client {
    provider = "prisma-client-js"
}

enum PersonType {
    NATURAL
    JURIDICAL
    @@schema("public")
}

enum CounterpartCategory {
    SUPPLIER
    PATIENT
    EMPLOYEE
    PARTNER
    RELATED
    OTHER
    CLIENT
    LENDER
    OCCASIONAL
    @@schema("public")
}

enum EmployeeStatus {
    ACTIVE
    INACTIVE
    TERMINATED
    @@schema("public")
}

enum EmployeeSalaryType {
    HOURLY
    FIXED
    @@schema("public")
}

enum TransactionDirection {
    IN
    OUT
    NEUTRO
    @@schema("public")
}

enum ServiceType {
    BUSINESS
    PERSONAL
    SUPPLIER
    TAX
    UTILITY
    LEASE
    SOFTWARE
    OTHER
    @@schema("public")
}

enum ServiceFrequency {
    WEEKLY
    BIWEEKLY
    MONTHLY
    BIMONTHLY
    QUARTERLY
    SEMIANNUAL
    ANNUAL
    ONCE
    @@schema("public")
}

enum ServiceStatus {
    ACTIVE
    INACTIVE
    ARCHIVED
    @@schema("public")
}

enum LoanStatus {
    ACTIVE
    COMPLETED
    DEFAULTED
    @@schema("public")
}

enum LoanScheduleStatus {
    PENDING
    PARTIAL
    PAID
    OVERDUE
    @@schema("public")
}

enum UserStatus {
    PENDING_SETUP
    ACTIVE
    SUSPENDED
    @@schema("public")
}

enum BudgetStatus {
    DRAFT
    SENT
    ACCEPTED
    REJECTED
    EXPIRED
    @@schema("public")
}

enum AttachmentType {
    CONSENT
    EXAM
    RECIPE
    OTHER
    @@schema("public")
}

model Person {
    id Int @id() @default(autoincrement())
    rut String @unique() @db.VarChar(20)
    names String
    fatherName String? @map("father_name")
    motherName String? @map("mother_name")
    email String?
    phone String?
    address String?
    personType PersonType @default(NATURAL) @map("person_type")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    counterpart Counterpart?
    employee Employee?
    transactions Transaction[]
    user User?
    patient Patient?

    @@map("people")
    @@schema("public")
}

model User {
    id Int @id() @default(autoincrement())
    personId Int @unique() @map("person_id")
    email String @unique()
    passwordHash String? @map("password_hash")
    status UserStatus @default(PENDING_SETUP)
    mfaSecret String? @map("mfa_secret")
    mfaEnabled Boolean @default(false) @map("mfa_enabled")
    passkeys Passkey[]
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    mfaEnforced Boolean @default(true) @map("mfa_enforced")
    dailyProductionBalances DailyProductionBalance[]
    pushSubscriptions PushSubscription[]
    supplyRequests SupplyRequest[]
    permissionVersion UserPermissionVersion?
    roles UserRoleAssignment[]
    medicalCertificates MedicalCertificate[]
    patientAttachments PatientAttachment[]
    person Person @relation(fields: [personId], references: [id], onDelete: Cascade)

    @@map("users")
    @@schema("public")
}

model Passkey {
    id String @id() @default(cuid())
    userId Int
    credentialId String @unique() @map("credential_id")
    publicKey Bytes @map("public_key")
    counter BigInt @default(0)
    transports Json?
    webAuthnUserID String @map("webauthn_user_id")
    deviceType String @map("device_type")
    backedUp Boolean @default(false) @map("backed_up")
    friendlyName String? @map("friendly_name")
    createdAt DateTime @default(now()) @map("created_at")
    lastUsedAt DateTime? @map("last_used_at")
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId])
    @@map("passkeys")
    @@schema("public")
}

model Role {
    id Int @id() @default(autoincrement())
    name String @unique()
    description String?
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    isSystem Boolean @default(false) @map("is_system")
    permissions RolePermission[]
    users UserRoleAssignment[]

    @@map("roles")
    @@schema("public")
}

model Permission {
    id Int @id() @default(autoincrement())
    action String
    subject String
    description String?
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    roles RolePermission[]

    @@unique([action, subject])
    @@map("permissions")
    @@schema("public")
}

model RolePermission {
    roleId Int @map("role_id")
    permissionId Int @map("permission_id")
    conditions Json?
    createdAt DateTime @default(now()) @map("created_at")
    permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
    role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)

    @@id([roleId, permissionId])
    @@map("role_permissions")
    @@schema("public")
}

model UserRoleAssignment {
    userId Int @map("user_id")
    roleId Int @map("role_id")
    assignedAt DateTime @default(now()) @map("assigned_at")
    role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@id([userId, roleId])
    @@map("user_role_assignments")
    @@schema("public")
}

model UserPermissionVersion {
    userId Int @id() @map("user_id")
    version Int @default(1)
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@map("user_permission_versions")
    @@schema("public")
}

model Employee {
    id Int @id() @default(autoincrement())
    personId Int @unique() @map("person_id")
    position String
    department String?
    startDate DateTime @map("start_date") @db.Date()
    endDate DateTime? @map("end_date") @db.Date()
    status EmployeeStatus @default(ACTIVE)
    salaryType EmployeeSalaryType @default(FIXED) @map("salary_type")
    baseSalary Decimal @default(0) @map("base_salary") @db.Decimal(12, 2)
    hourlyRate Decimal? @map("hourly_rate") @db.Decimal(10, 2)
    bankName String? @map("bank_name")
    bankAccountType String? @map("bank_account_type")
    bankAccountNumber String? @map("bank_account_number")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    metadata Json?
    overtimeRate Decimal? @map("overtime_rate") @db.Decimal(10, 2)
    retentionRate Decimal @default(0.145) @map("retention_rate") @db.Decimal(5, 4)
    timesheets EmployeeTimesheet[]
    person Person @relation(fields: [personId], references: [id], onDelete: Cascade)

    @@map("employees")
    @@schema("public")
}

model Counterpart {
    id Int @id() @default(autoincrement())
    personId Int @unique() @map("person_id")
    category CounterpartCategory @default(SUPPLIER)
    notes String?
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    accounts CounterpartAccount[]
    person Person @relation(fields: [personId], references: [id], onDelete: Cascade)
    services Service[]

    @@map("counterparts")
    @@schema("public")
}

model CounterpartAccount {
    id Int @id() @default(autoincrement())
    counterpartId Int @map("counterpart_id")
    bankName String? @map("bank_name")
    accountType String? @map("account_type")
    accountNumber String @map("account_number")
    counterpart Counterpart @relation(fields: [counterpartId], references: [id], onDelete: Cascade)

    @@map("counterpart_accounts")
    @@index([counterpartId])
    @@schema("public")
}

model EmployeeTimesheet {
    id BigInt @id() @default(autoincrement())
    employeeId Int @map("employee_id")
    workDate DateTime @map("work_date") @db.Date()
    startTime DateTime? @map("start_time") @db.Time(6)
    endTime DateTime? @map("end_time") @db.Time(6)
    workedMinutes Int @map("worked_minutes")
    overtimeMinutes Int @default(0) @map("overtime_minutes")
    comment String?
    employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

    @@unique([employeeId, workDate])
    @@index([employeeId])
    @@map("employee_timesheets")
    @@schema("public")
}

model Transaction {
    id Int @id() @default(autoincrement())
    description String? @map("description")
    person_id Int?
    created_at DateTime @default(now())
    businessUnit String? @map("business_unit")
    cardInitialNumber String? @map("card_initial_number")
    couponAmount Decimal? @map("coupon_amount") @db.Decimal(17, 2)
    externalPosId String? @map("external_pos_id")
    externalReference String? @map("external_reference")
    externalStoreId String? @map("external_store_id")
    feeAmount Decimal? @map("fee_amount") @db.Decimal(17, 2)
    financingFeeAmount Decimal? @map("financing_fee_amount") @db.Decimal(17, 2)
    franchise String?
    installments Int?
    invoicingPeriod String? @map("invoicing_period")
    isReleased Boolean? @map("is_released")
    issuerName String? @map("issuer_name")
    lastFourDigits String? @map("last_four_digits")
    metadata Json?
    mkpFeeAmount Decimal? @map("mkp_fee_amount") @db.Decimal(17, 2)
    moneyReleaseDate DateTime? @map("money_release_date")
    operationTags Json? @map("operation_tags")
    orderId BigInt? @map("order_id")
    orderMp String? @map("order_mp")
    packId BigInt? @map("pack_id")
    payBankTransferId String? @map("pay_bank_transfer_id")
    paymentMethod String? @map("payment_method")
    paymentMethodType String? @map("payment_method_type")
    poiBankName String? @map("poi_bank_name")
    poiId String? @map("poi_id")
    poiWalletName String? @map("poi_wallet_name")
    posId String? @map("pos_id")
    posName String? @map("pos_name")
    productSku String? @map("product_sku")
    purchaseId String? @map("purchase_id")
    realAmount Decimal? @map("real_amount") @db.Decimal(17, 2)
    saleDetail String? @map("sale_detail")
    sellerAmount Decimal? @map("seller_amount") @db.Decimal(17, 2)
    settlementCurrency String? @map("settlement_currency") @db.VarChar(10)
    settlementDate DateTime? @map("settlement_date")
    settlementNetAmount Decimal? @map("settlement_net_amount") @db.Decimal(17, 2)
    shipmentMode String? @map("shipment_mode")
    shippingFeeAmount Decimal? @map("shipping_fee_amount") @db.Decimal(17, 2)
    shippingId BigInt? @map("shipping_id")
    shippingOrderId String? @map("shipping_order_id")
    site String?
    sourceId String? @map("source_id")
    status String?
    storeId String? @map("store_id")
    storeName String? @map("store_name")
    subUnit String? @map("sub_unit")
    taxDetail String? @map("tax_detail")
    taxesAmount Decimal? @map("taxes_amount") @db.Decimal(17, 2)
    taxesDisaggregated Json? @map("taxes_disaggregated")
    tipAmount Decimal? @map("tip_amount") @db.Decimal(17, 2)
    totalCouponAmount Decimal? @map("total_coupon_amount") @db.Decimal(17, 2)
    transactionAmount Decimal @map("transaction_amount") @db.Decimal(17, 2)
    transactionCurrency String @map("transaction_currency") @db.VarChar(10)
    transactionDate DateTime @map("transaction_date")
    transactionIntentId String? @map("transaction_intent_id")
    transactionType String @map("transaction_type")
    userId String? @map("user_id")
    people Person? @relation(fields: [person_id], references: [id])

    @@unique([sourceId, transactionType], map: "unique_mp_tx")
    @@index([person_id])
    @@index([transactionDate])
    @@map("transactions")
    @@schema("public")
}

model SettlementTransaction {
    id Int @id() @default(autoincrement())
    sourceId String @unique() @map("source_id") @db.VarChar(100)
    transactionDate DateTime @map("transaction_date")
    settlementDate DateTime? @map("settlement_date")
    moneyReleaseDate DateTime? @map("money_release_date")
    externalReference String? @map("external_reference") @db.VarChar(255)
    userId String? @map("user_id") @db.VarChar(19)
    paymentMethodType String? @map("payment_method_type") @db.VarChar(200)
    paymentMethod String? @map("payment_method") @db.VarChar(50)
    site String? @db.VarChar(200)
    transactionType String @map("transaction_type") @db.VarChar(200)
    transactionAmount Decimal @map("transaction_amount") @db.Decimal(17, 2)
    transactionCurrency String @map("transaction_currency") @db.VarChar(10)
    sellerAmount Decimal? @map("seller_amount") @db.Decimal(17, 2)
    feeAmount Decimal? @map("fee_amount") @db.Decimal(17, 2)
    settlementNetAmount Decimal? @map("settlement_net_amount") @db.Decimal(17, 2)
    settlementCurrency String? @map("settlement_currency") @db.VarChar(10)
    realAmount Decimal? @map("real_amount") @db.Decimal(17, 2)
    couponAmount Decimal? @map("coupon_amount") @db.Decimal(17, 2)
    metadata Json?
    mkpFeeAmount Decimal? @map("mkp_fee_amount") @db.Decimal(17, 2)
    financingFeeAmount Decimal? @map("financing_fee_amount") @db.Decimal(17, 2)
    shippingFeeAmount Decimal? @map("shipping_fee_amount") @db.Decimal(17, 2)
    taxesAmount Decimal? @map("taxes_amount") @db.Decimal(17, 2)
    installments Int?
    taxDetail String? @map("tax_detail") @db.VarChar(50)
    taxesDisaggregated Json? @map("taxes_disaggregated")
    description String? @db.VarChar(50)
    cardInitialNumber String? @map("card_initial_number") @db.VarChar(8)
    operationTags Json? @map("operation_tags")
    businessUnit String? @map("business_unit") @db.VarChar(255)
    subUnit String? @map("sub_unit") @db.VarChar(255)
    productSku String? @map("product_sku") @db.VarChar(200)
    saleDetail String? @map("sale_detail") @db.VarChar(500)
    transactionIntentId String? @map("transaction_intent_id")
    franchise String?
    issuerName String? @map("issuer_name")
    lastFourDigits String? @map("last_four_digits") @db.VarChar(4)
    orderMp String? @map("order_mp")
    invoicingPeriod String? @map("invoicing_period")
    payBankTransferId String? @map("pay_bank_transfer_id")
    isReleased Boolean? @map("is_released")
    tipAmount Decimal? @map("tip_amount") @db.Decimal(17, 2)
    purchaseId String? @map("purchase_id")
    totalCouponAmount Decimal? @map("total_coupon_amount") @db.Decimal(17, 2)
    posId String? @map("pos_id") @db.VarChar(50)
    posName String? @map("pos_name") @db.VarChar(200)
    externalPosId String? @map("external_pos_id") @db.VarChar(100)
    storeId String? @map("store_id") @db.VarChar(50)
    storeName String? @map("store_name") @db.VarChar(200)
    externalStoreId String? @map("external_store_id") @db.VarChar(100)
    poiId String? @map("poi_id") @db.VarChar(50)
    orderId BigInt? @map("order_id")
    shippingId BigInt? @map("shipping_id")
    shipmentMode String? @map("shipment_mode") @db.VarChar(10)
    packId BigInt? @map("pack_id")
    shippingOrderId String? @map("shipping_order_id")
    poiWalletName String? @map("poi_wallet_name") @db.VarChar(200)
    poiBankName String? @map("poi_bank_name") @db.VarChar(200)
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")

    @@index([transactionDate])
    @@index([transactionType])
    @@index([externalReference])
    @@map("settlement_transactions")
    @@schema("public")
}

model ReleaseTransaction {
    id Int @id() @default(autoincrement())
    sourceId String @unique() @map("source_id") @db.VarChar(100)
    date DateTime @map("date")
    externalReference String? @map("external_reference") @db.VarChar(255)
    recordType String? @map("record_type")
    description String? @db.VarChar(500)
    netCreditAmount Decimal? @map("net_credit_amount") @db.Decimal(17, 2)
    netDebitAmount Decimal? @map("net_debit_amount") @db.Decimal(17, 2)
    grossAmount Decimal @map("gross_amount") @db.Decimal(17, 2)
    sellerAmount Decimal? @map("seller_amount") @db.Decimal(17, 2)
    mpFeeAmount Decimal? @map("mp_fee_amount") @db.Decimal(17, 2)
    financingFeeAmount Decimal? @map("financing_fee_amount") @db.Decimal(17, 2)
    shippingFeeAmount Decimal? @map("shipping_fee_amount") @db.Decimal(17, 2)
    taxesAmount Decimal? @map("taxes_amount") @db.Decimal(17, 2)
    couponAmount Decimal? @map("coupon_amount") @db.Decimal(17, 2)
    effectiveCouponAmount Decimal? @map("effective_coupon_amount") @db.Decimal(17, 2)
    balanceAmount Decimal? @map("balance_amount") @db.Decimal(17, 2)
    taxAmountTelco Decimal? @map("tax_amount_telco") @db.Decimal(17, 2)
    installments Int?
    paymentMethod String? @map("payment_method") @db.VarChar(50)
    paymentMethodType String? @map("payment_method_type") @db.VarChar(200)
    taxDetail String? @map("tax_detail")
    taxesDisaggregated Json? @map("taxes_disaggregated")
    transactionApprovalDate DateTime? @map("transaction_approval_date")
    transactionIntentId String? @map("transaction_intent_id")
    posId String? @map("pos_id")
    posName String? @map("pos_name")
    externalPosId String? @map("external_pos_id")
    storeId String? @map("store_id")
    storeName String? @map("store_name")
    externalStoreId String? @map("external_store_id")
    currency String? @db.VarChar(10)
    shippingId BigInt? @map("shipping_id")
    shipmentMode String? @map("shipment_mode")
    shippingOrderId String? @map("shipping_order_id")
    orderId BigInt? @map("order_id")
    packId BigInt? @map("pack_id")
    poiId String? @map("poi_id")
    itemId String? @map("item_id")
    metadata Json?
    cardInitialNumber String? @map("card_initial_number") @db.VarChar(8)
    operationTags Json? @map("operation_tags")
    lastFourDigits String? @map("last_four_digits") @db.VarChar(4)
    franchise String?
    issuerName String? @map("issuer_name")
    poiBankName String? @map("poi_bank_name")
    poiWalletName String? @map("poi_wallet_name")
    businessUnit String? @map("business_unit")
    subUnit String? @map("sub_unit")
    payoutBankAccountNumber String? @map("payout_bank_account_number")
    productSku String? @map("product_sku")
    saleDetail String? @map("sale_detail")
    orderMp String? @map("order_mp")
    purchaseId String? @map("purchase_id")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")

    @@index([date])
    @@index([sourceId])
    @@map("release_transactions")
    @@schema("public")
}

model DailyBalance {
    id Int @id() @default(autoincrement())
    date DateTime @unique() @db.Date()
    amount Decimal @db.Decimal(15, 2)
    note String?
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")

    @@map("daily_balances")
    @@schema("public")
}

model Service {
    id Int @id() @default(autoincrement())
    name String
    counterpartId Int? @map("counterpart_id")
    type ServiceType @default(BUSINESS)
    frequency ServiceFrequency @default(MONTHLY)
    defaultAmount Decimal @default(0) @map("default_amount") @db.Decimal(15, 2)
    status ServiceStatus @default(ACTIVE)
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    counterpart Counterpart? @relation(fields: [counterpartId], references: [id])

    @@index([counterpartId])
    @@map("services")
    @@schema("public")
}

model Loan {
    id Int @id() @default(autoincrement())
    title String
    principalAmount Decimal @map("principal_amount") @db.Decimal(15, 2)
    interestRate Decimal @map("interest_rate") @db.Decimal(9, 6)
    startDate DateTime @map("start_date") @db.Date()
    status LoanStatus @default(ACTIVE)
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    schedules LoanSchedule[]

    @@map("loans")
    @@schema("public")
}

model LoanSchedule {
    id Int @id() @default(autoincrement())
    loanId Int @map("loan_id")
    installmentNumber Int @map("installment_number")
    dueDate DateTime @map("due_date") @db.Date()
    expectedAmount Decimal @map("expected_amount") @db.Decimal(15, 2)
    status LoanScheduleStatus @default(PENDING)
    loan Loan @relation(fields: [loanId], references: [id], onDelete: Cascade)

    @@index([loanId])
    @@map("loan_schedules")
    @@schema("public")
}

model Setting {
    key String @id()
    value String?
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")

    @@map("settings")
    @@schema("public")
}

model PushSubscription {
    id Int @id() @default(autoincrement())
    userId Int @map("user_id")
    endpoint String @unique()
    keys Json
    createdAt DateTime @default(now()) @map("created_at")
    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@index([userId])
    @@map("push_subscriptions")
    @@schema("public")
}

model Calendar {
    id Int @id() @default(autoincrement())
    googleId String @unique() @map("google_id")
    name String?
    syncToken String? @map("sync_token")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    watchChannels CalendarWatchChannel[]
    events Event[]

    @@map("calendars")
    @@schema("public")
}

model CalendarWatchChannel {
    id Int @id() @default(autoincrement())
    calendarId Int @map("calendar_id")
    channelId String @unique() @map("channel_id")
    resourceId String @map("resource_id")
    expiration DateTime
    webhookUrl String @map("webhook_url")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    calendar Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)

    @@index([calendarId])
    @@map("calendar_watch_channels")
    @@schema("public")
}

model Event {
    id Int @id() @default(autoincrement())
    calendarId Int @map("calendar_id")
    externalEventId String @map("external_event_id")
    eventStatus String? @map("event_status")
    eventType String? @map("event_type")
    summary String?
    description String?
    startDate DateTime? @map("start_date") @db.Date()
    startDateTime DateTime? @map("start_date_time")
    startTimeZone String? @map("start_time_zone")
    endDate DateTime? @map("end_date") @db.Date()
    endDateTime DateTime? @map("end_date_time")
    endTimeZone String? @map("end_time_zone")
    eventCreatedAt DateTime? @map("event_created_at")
    eventUpdatedAt DateTime? @map("event_updated_at")
    colorId String? @map("color_id")
    location String?
    transparency String?
    visibility String?
    hangoutLink String? @map("hangout_link")
    category String?
    amountExpected Int? @map("amount_expected")
    amountPaid Int? @map("amount_paid")
    attended Boolean?
    dosage String?
    treatmentStage String? @map("treatment_stage")
    rawEvent Json? @map("raw_event")
    lastSyncedAt DateTime @map("last_synced_at")
    calendar Calendar @relation(fields: [calendarId], references: [id])
    consultations Consultation[]

    @@unique([calendarId, externalEventId])
    @@index([calendarId])
    @@map("events")
    @@schema("public")
}

model SyncLog {
    id BigInt @id() @default(autoincrement())
    triggerSource String @map("trigger_source")
    triggerUserId Int? @map("trigger_user_id")
    triggerLabel String? @map("trigger_label")
    status String @default("SUCCESS")
    startedAt DateTime @map("started_at")
    finishedAt DateTime? @map("finished_at")
    fetchedAt DateTime? @map("fetched_at")
    inserted Int? @default(0)
    updated Int? @default(0)
    skipped Int? @default(0)
    excluded Int? @default(0)
    errorMessage String? @map("error_message")
    changeDetails Json? @map("change_details")

    @@map("sync_logs")
    @@schema("public")
}

model BackupLog {
    id String @id()
    timestamp DateTime @default(now())
    level String
    message String
    context Json?
    jobId String? @map("job_id")

    @@index([timestamp(sort: Desc)])
    @@map("backup_logs")
    @@schema("public")
}

model InventoryCategory {
    id Int @id() @default(autoincrement())
    name String @unique()
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    items InventoryItem[]

    @@map("inventory_categories")
    @@schema("public")
}

model InventoryItem {
    id Int @id() @default(autoincrement())
    categoryId Int? @map("category_id")
    name String
    description String?
    currentStock Int @default(0) @map("current_stock")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    category InventoryCategory? @relation(fields: [categoryId], references: [id])
    movements InventoryMovement[]

    @@index([categoryId])
    @@map("inventory_items")
    @@schema("public")
}

model InventoryMovement {
    id Int @id() @default(autoincrement())
    itemId Int @map("item_id")
    quantityChange Int @map("quantity_change")
    reason String?
    createdAt DateTime @default(now()) @map("created_at")
    item InventoryItem @relation(fields: [itemId], references: [id], onDelete: Cascade)

    @@index([itemId])
    @@map("inventory_movements")
    @@schema("public")
}

model DailyProductionBalance {
    id Int @id() @default(autoincrement())
    balanceDate DateTime @unique() @map("balance_date") @db.Date()
    ingresoTarjetas Int @default(0) @map("ingreso_tarjetas")
    ingresoTransferencias Int @default(0) @map("ingreso_transferencias")
    ingresoEfectivo Int @default(0) @map("ingreso_efectivo")
    gastosDiarios Int @default(0) @map("gastos_diarios")
    otrosAbonos Int @default(0) @map("otros_abonos")
    comentarios String?
    status String @default("DRAFT")
    changeReason String? @map("change_reason")
    createdBy Int @map("created_by")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    consultasMonto Int @default(0) @map("consultas_monto")
    controlesMonto Int @default(0) @map("controles_monto")
    licenciasMonto Int @default(0) @map("licencias_monto")
    roxairMonto Int @default(0) @map("roxair_monto")
    testsMonto Int @default(0) @map("tests_monto")
    vacunasMonto Int @default(0) @map("vacunas_monto")
    user User @relation(fields: [createdBy], references: [id])

    @@index([createdBy])
    @@map("daily_production_balances")
    @@schema("public")
}

model SupplyRequest {
    id Int @id() @default(autoincrement())
    userId Int @map("user_id")
    supplyName String @map("supply_name")
    quantity Int
    brand String?
    model String?
    notes String?
    status String @default("PENDING")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    user User @relation(fields: [userId], references: [id])

    @@index([userId])
    @@map("supply_requests")
    @@schema("public")
}

model CommonSupply {
    id Int @id() @default(autoincrement())
    name String
    brand String?
    model String?
    createdAt DateTime @default(now()) @map("created_at")

    @@unique([name, brand, model])
    @@map("common_supplies")
    @@schema("public")
}

model CalendarSyncLog {
    id Int @id() @default(autoincrement())
    triggerSource String? @map("trigger_source")
    triggerUserId Int? @map("trigger_user_id")
    triggerLabel String? @map("trigger_label")
    status String @default("PENDING")
    startedAt DateTime @default(now()) @map("started_at")
    endedAt DateTime? @map("ended_at")
    fetchedAt DateTime? @map("fetched_at")
    eventsSynced Int @default(0) @map("events_synced")
    inserted Int? @default(0)
    updated Int? @default(0)
    skipped Int? @default(0)
    excluded Int? @default(0)
    errorMessage String? @map("error_message")
    changeDetails Json? @map("change_details")

    @@index([startedAt(sort: Desc)])
    @@map("calendar_sync_logs")
    @@schema("public")
}

model DoctoraliaFacility {
    id Int @id() @default(autoincrement())
    externalId String @unique() @map("external_id")
    name String
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    doctors DoctoraliaDoctor[]

    @@map("doctoralia_facilities")
    @@schema("public")
}

model DoctoraliaDoctor {
    id Int @id() @default(autoincrement())
    facilityId Int @map("facility_id")
    externalId String @map("external_id")
    name String
    surname String
    profileUrl String? @map("profile_url")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    facility DoctoraliaFacility @relation(fields: [facilityId], references: [id], onDelete: Cascade)
    addresses DoctoraliaAddress[]

    @@unique([facilityId, externalId])
    @@index([facilityId])
    @@map("doctoralia_doctors")
    @@schema("public")
}

model DoctoraliaAddress {
    id Int @id() @default(autoincrement())
    doctorId Int @map("doctor_id")
    externalId String @map("external_id")
    name String?
    cityName String? @map("city_name")
    postCode String? @map("post_code")
    street String?
    onlineOnly Boolean @default(false) @map("online_only")
    calendarEnabled Boolean @default(true) @map("calendar_enabled")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    doctor DoctoraliaDoctor @relation(fields: [doctorId], references: [id], onDelete: Cascade)
    services DoctoraliaService[]
    insuranceProviders DoctoraliaInsuranceProvider[]
    slots DoctoraliaSlot[]
    bookings DoctoraliaBooking[]
    breaks DoctoraliaCalendarBreak[]

    @@unique([doctorId, externalId])
    @@index([doctorId])
    @@map("doctoralia_addresses")
    @@schema("public")
}

model DoctoraliaService {
    id Int @id() @default(autoincrement())
    addressId Int @map("address_id")
    externalId String @map("external_id")
    serviceId String? @map("service_id")
    name String
    price Int?
    isPriceFrom Boolean @default(false) @map("is_price_from")
    isDefault Boolean @default(false) @map("is_default")
    isVisible Boolean @default(true) @map("is_visible")
    description String?
    defaultDuration Int? @map("default_duration")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    address DoctoraliaAddress @relation(fields: [addressId], references: [id], onDelete: Cascade)

    @@unique([addressId, externalId])
    @@index([addressId])
    @@map("doctoralia_services")
    @@schema("public")
}

model DoctoraliaInsuranceProvider {
    id Int @id() @default(autoincrement())
    addressId Int @map("address_id")
    insuranceProviderId String @map("insurance_provider_id")
    name String
    createdAt DateTime @default(now()) @map("created_at")
    address DoctoraliaAddress @relation(fields: [addressId], references: [id], onDelete: Cascade)

    @@unique([addressId, insuranceProviderId])
    @@index([addressId])
    @@map("doctoralia_insurance_providers")
    @@schema("public")
}

model DoctoraliaSlot {
    id Int @id() @default(autoincrement())
    addressId Int @map("address_id")
    startAt DateTime @map("start_at")
    endAt DateTime @map("end_at")
    createdAt DateTime @default(now()) @map("created_at")
    address DoctoraliaAddress @relation(fields: [addressId], references: [id], onDelete: Cascade)

    @@index([addressId])
    @@index([startAt])
    @@map("doctoralia_slots")
    @@schema("public")
}

model DoctoraliaBooking {
    id Int @id() @default(autoincrement())
    addressId Int @map("address_id")
    externalId String @map("external_id")
    status String @default("booked")
    startAt DateTime @map("start_at")
    endAt DateTime @map("end_at")
    duration Int
    bookedBy String? @map("booked_by")
    bookedAt DateTime? @map("booked_at")
    canceledBy String? @map("canceled_by")
    canceledAt DateTime? @map("canceled_at")
    patientName String? @map("patient_name")
    patientSurname String? @map("patient_surname")
    patientEmail String? @map("patient_email")
    patientPhone String? @map("patient_phone")
    comment String?
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    address DoctoraliaAddress @relation(fields: [addressId], references: [id], onDelete: Cascade)

    @@unique([addressId, externalId])
    @@index([addressId])
    @@index([startAt])
    @@map("doctoralia_bookings")
    @@schema("public")
}

model DoctoraliaCalendarBreak {
    id Int @id() @default(autoincrement())
    addressId Int @map("address_id")
    externalId String @map("external_id")
    since DateTime
    till DateTime
    description String?
    createdAt DateTime @default(now()) @map("created_at")
    address DoctoraliaAddress @relation(fields: [addressId], references: [id], onDelete: Cascade)

    @@unique([addressId, externalId])
    @@index([addressId])
    @@map("doctoralia_calendar_breaks")
    @@schema("public")
}

model DoctoraliaSyncLog {
    id Int @id() @default(autoincrement())
    triggerSource String? @map("trigger_source")
    triggerUserId Int? @map("trigger_user_id")
    status String @default("PENDING")
    startedAt DateTime @default(now()) @map("started_at")
    endedAt DateTime? @map("ended_at")
    facilitiesSynced Int @default(0) @map("facilities_synced")
    doctorsSynced Int @default(0) @map("doctors_synced")
    slotsSynced Int @default(0) @map("slots_synced")
    bookingsSynced Int @default(0) @map("bookings_synced")
    errorMessage String? @map("error_message")

    @@index([startedAt(sort: Desc)])
    @@map("doctoralia_sync_logs")
    @@schema("public")
}

model PersonalCredit {
    id Int @id() @default(autoincrement())
    bankName String @map("bank_name")
    creditNumber String @unique() @map("credit_number")
    description String?
    totalAmount Decimal @map("total_amount") @db.Decimal(15, 2)
    currency String @default("CLP")
    interestRate Decimal? @map("interest_rate") @db.Decimal(5, 2)
    startDate DateTime @map("start_date") @db.Date()
    totalInstallments Int @map("total_installments")
    status String @default("ACTIVE")
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    installments PersonalCreditInstallment[]

    @@schema("personal")
    @@map("credits")
}

model PersonalCreditInstallment {
    id Int @id() @default(autoincrement())
    creditId Int @map("credit_id")
    installmentNumber Int @map("installment_number")
    dueDate DateTime @map("due_date") @db.Date()
    amount Decimal @db.Decimal(15, 2)
    capitalAmount Decimal? @map("capital_amount") @db.Decimal(15, 2)
    interestAmount Decimal? @map("interest_amount") @db.Decimal(15, 2)
    otherCharges Decimal? @map("other_charges") @db.Decimal(15, 2)
    status String @default("PENDING")
    paidAt DateTime? @map("paid_at")
    paidAmount Decimal? @map("paid_amount") @db.Decimal(15, 2)
    credit PersonalCredit @relation(fields: [creditId], references: [id], onDelete: Cascade)

    @@schema("personal")
    @@index([creditId])
    @@unique([creditId, installmentNumber])
    @@map("credit_installments")
}

model MedicalCertificate {
    id String @id() @default(cuid())
    patientName String @map("patient_name")
    patientRut String @map("patient_rut")
    birthDate DateTime @map("birth_date") @db.Date()
    address String
    diagnosis String
    symptoms String?
    restDays Int? @map("rest_days")
    restStartDate DateTime? @map("rest_start_date") @db.Date()
    restEndDate DateTime? @map("rest_end_date") @db.Date()
    purpose String
    purposeDetail String? @map("purpose_detail")
    issuedBy Int @map("issued_by")
    issuedAt DateTime @default(now()) @map("issued_at")
    patientId Int? @map("patient_id")
    driveFileId String @map("drive_file_id")
    pdfHash String @map("pdf_hash")
    metadata Json?
    issuer User @relation(fields: [issuedBy], references: [id])
    patient Patient? @relation(fields: [patientId], references: [id])

    @@index([patientRut])
    @@index([issuedAt])
    @@map("medical_certificates")
    @@schema("public")
}

model Patient {
    id Int @id() @default(autoincrement())
    personId Int @unique() @map("person_id")
    birthDate DateTime @map("birth_date") @db.Date()
    bloodType String? @map("blood_type")
    notes String?
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    person Person @relation(fields: [personId], references: [id], onDelete: Cascade)
    consultations Consultation[]
    medicalCertificates MedicalCertificate[]
    budgets Budget[]
    payments PatientPayment[]
    attachments PatientAttachment[]

    @@map("patients")
    @@schema("public")
}

model Consultation {
    id Int @id() @default(autoincrement())
    patientId Int @map("patient_id")
    eventId Int? @map("event_id")
    date DateTime @db.Date()
    reason String
    diagnosis String?
    treatment String?
    notes String?
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    patient Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
    event Event? @relation(fields: [eventId], references: [id])

    @@index([patientId])
    @@index([eventId])
    @@index([date])
    @@map("consultations")
    @@schema("public")
}

model Budget {
    id Int @id() @default(autoincrement())
    patientId Int @map("patient_id")
    title String
    totalAmount Decimal @map("total_amount") @db.Decimal(15, 2)
    discount Decimal @default(0) @db.Decimal(15, 2)
    finalAmount Decimal @map("final_amount") @db.Decimal(15, 2)
    status BudgetStatus @default(DRAFT)
    notes String?
    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @default(now()) @updatedAt() @map("updated_at")
    patient Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
    items BudgetItem[]
    payments PatientPayment[]

    @@index([patientId])
    @@map("budgets")
    @@schema("public")
}

model BudgetItem {
    id Int @id() @default(autoincrement())
    budgetId Int @map("budget_id")
    description String
    quantity Int @default(1)
    unitPrice Decimal @map("unit_price") @db.Decimal(15, 2)
    totalPrice Decimal @map("total_price") @db.Decimal(15, 2)
    budget Budget @relation(fields: [budgetId], references: [id], onDelete: Cascade)

    @@index([budgetId])
    @@map("budget_items")
    @@schema("public")
}

model PatientPayment {
    id Int @id() @default(autoincrement())
    patientId Int @map("patient_id")
    budgetId Int? @map("budget_id")
    amount Decimal @db.Decimal(15, 2)
    paymentDate DateTime @default(now()) @map("payment_date")
    paymentMethod String @map("payment_method")
    reference String?
    notes String?
    createdAt DateTime @default(now()) @map("created_at")
    patient Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
    budget Budget? @relation(fields: [budgetId], references: [id])

    @@index([patientId])
    @@index([budgetId])
    @@map("patient_payments")
    @@schema("public")
}

model PatientAttachment {
    id String @id() @default(cuid())
    patientId Int @map("patient_id")
    name String
    type AttachmentType @default(OTHER)
    driveFileId String @map("drive_file_id")
    mimeType String? @map("mime_type")
    uploadedBy Int @map("uploaded_by")
    uploadedAt DateTime @default(now()) @map("uploaded_at")
    patient Patient @relation(fields: [patientId], references: [id], onDelete: Cascade)
    uploader User @relation(fields: [uploadedBy], references: [id])

    @@index([patientId])
    @@map("patient_attachments")
    @@schema("public")
}